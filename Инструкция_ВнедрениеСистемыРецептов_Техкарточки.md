# Система кулинарных рецептов с технологическими картами для БАС Управление торговли

## Описание функциональности

Обновленная система позволяет:
- Вести справочник технологических карт с детальным составом ингредиентов
- Связывать готовые блюда из основной номенклатуры с техкарточками через рецепты
- Автоматически списывать ингредиенты при продаже блюд через кассу на основе техкарточек
- Анализировать себестоимость и использование ингредиентов
- Планировать потребности в ингредиентах
- Вести полную пищевую ценность блюд (БЖУ, калорийность)
- Контролировать нормы вложения сырья (брутто/нетто)

## Состав решения

### 1. Справочник "Технологические карты"
**Файлы:**
- `Справочник_Техкарточки.xml` - структура справочника
- `Справочник_Техкарточки.bsl` - модуль справочника
- `Форма_Техкарточки.xml` - форма элемента

**Реквизиты:**
- Код, Наименование - стандартные реквизиты
- НомерТехкарточки (Строка) - официальный номер техкарточки
- ГотовоеБлюдо (Справочник.Номенклатура) - связь с основной номенклатурой
- КатегорияБлюда (Перечисление.КатегорииБлюд) - категория блюда
- ВыходПорции (Число) - выход готовой порции в граммах
- КалорийностьПорции (Число) - энергетическая ценность в ккал
- Белки (Число) - содержание белков в граммах
- Жиры (Число) - содержание жиров в граммах  
- Углеводы (Число) - содержание углеводов в граммах
- ВремяПриготовления (Число) - время приготовления в минутах
- ТехнологияПриготовления (Строка) - подробное описание процесса
- ТребованияКСырью (Строка) - требования к качеству сырья
- ПоказателиГотовогоБлюда (Строка) - органолептические показатели
- СебестоимостьПорции (Число) - расчетная себестоимость порции

**Табличная часть "СоставИнгредиентов":**
- Ингредиент (Справочник.Номенклатура) - наименование сырья
- НормаБрутто (Число) - норма закладки в граммах брутто
- НормаНетто (Число) - норма закладки в граммах нетто
- ПроцентОтходов (Число) - процент отходов при обработке
- СтоимостьЕдиницы (Число) - цена за килограмм
- СуммаСтоимости (Число) - стоимость ингредиента в рецепте
- Комментарий (Строка) - способ обработки и использования

### 2. Справочник "Кулинарные рецепты" (обновленный)
**Файлы:**
- `Справочник_КулинарныеРецепты.xml` - структура справочника (обновлен)
- `Справочник_КулинарныеРецепты.bsl` - модуль справочника (обновлен)
- `Форма_КулинарныеРецепты.xml` - форма элемента (обновлена)

**Основные изменения:**
- Удалена табличная часть "СоставИнгредиентов"
- Добавлен реквизит "Техкарточка" (Справочник.Техкарточки)
- Добавлены команды для создания и открытия техкарточек
- Пересчет себестоимости теперь происходит на основе техкарточки

**Реквизиты:**
- Код, Наименование - стандартные реквизиты
- ГотовоеБлюдо (Справочник.Номенклатура) - связь с основной номенклатурой
- КатегорияБлюда (Перечисление.КатегорииБлюд) - категория блюда
- ВремяПриготовления (Число) - время приготовления в минутах
- КоличествоПорций (Число) - количество порций в рецепте
- СебестоимостьПорции (Число) - расчетная себестоимость порции
- ТехнологияПриготовления (Строка) - описание технологии приготовления
- Техкарточка (Справочник.Техкарточки) - ссылка на технологическую карту

### 3. Перечисление "Категории блюд"
**Файл:** `Перечисление_КатегорииБлюд.xml`

**Значения:**
- Супы
- Вторые блюда
- Гарниры
- Салаты
- Десерты
- Напитки
- Выпечка
- Горячие закуски
- Холодные закуски

### 4. Автоматическое списание ингредиентов (обновлено)
**Файл:** `Документ_ПродажаБлюд_СписаниеИнгредиентов.bsl`

**Обновленный принцип работы:**
1. При проведении документа продажи система проверяет, есть ли среди проданных товаров готовые блюда
2. Для каждого блюда ищется соответствующий рецепт с техкарточкой
3. По техкарточке рассчитывается необходимое количество каждого ингредиента (используется норма брутто)
4. Проверяется наличие ингредиентов на складе
5. Создаются движения по регистру "ТоварыНаСкладах" (списание ингредиентов)
6. Создаются аналитические записи в регистре "СписаниеПоРецептам"

### 5. Регистр накопления "Списание по рецептам"
**Файл:** `РегистрНакопления_СписаниеПоРецептам.xml`

**Назначение:** Аналитика использования ингредиентов по рецептам

**Измерения:**
- Рецепт - кулинарный рецепт
- ГотовоеБлюдо - реализованное блюдо
- Ингредиент - использованный ингредиент
- Склад - склад списания

**Ресурсы:**
- КоличествоПорций - количество приготовленных порций
- КоличествоИнгредиента - количество использованного ингредиента
- СтоимостьИнгредиента - стоимость использованного ингредиента

### 6. Обработка анализа себестоимости
**Файл:** `Обработка_АнализСебестоимостиБлюд.bsl`

**Функции:**
- Анализ использования ингредиентов за период
- Расчет фактической себестоимости блюд
- Детализация по ингредиентам
- Планирование потребностей в ингредиентах

## Инструкция по внедрению

### Шаг 1: Загрузка объектов конфигурации
1. Добавьте в конфигурацию справочник "Техкарточки"
2. Обновите справочник "КулинарныеРецепты" (удалите табличную часть, добавьте реквизит Техкарточка)
3. Добавьте перечисление "КатегорииБлюд" (если его еще нет)
4. Добавьте регистр накопления "СписаниеПоРецептам" (если его еще нет)
5. Добавьте обработку "АнализСебестоимостиБлюд"

### Шаг 2: Модификация документов продажи
1. В модуле документа "ПродажиТоваровУслуг" (или аналогичного) добавьте обновленный код из файла `Документ_ПродажаБлюд_СписаниеИнгредиентов.bsl` в процедуры:
   - ОбработкаПроведения()
   - ОбработкаОтменыПроведения()

### Шаг 3: Настройка номенклатуры
1. Создайте виды номенклатуры:
   - "Готовые блюда" - для блюд в меню
   - "Материалы" или "Ингредиенты" - для компонентов блюд

2. Заполните номенклатуру:
   - Добавьте все готовые блюда, которые продаются через кассу
   - Добавьте все ингредиенты, используемые в рецептах

### Шаг 4: Создание технологических карт
1. Откройте справочник "Технологические карты"
2. Создайте техкарточки для всех блюд:
   - Заполните основные реквизиты (название, номер, категория)
   - Обязательно укажите связь с номенклатурой готового блюда
   - Заполните показатели блюда (выход, время приготовления, БЖУ)
   - Добавьте все ингредиенты в табличную часть с нормами брутто/нетто
   - Заполните технологию приготовления и требования к сырью
   - Воспользуйтесь кнопкой "Пересчитать себестоимость" для автоматического расчета

### Шаг 5: Настройка рецептов
1. Откройте справочник "Кулинарные рецепты"
2. Создайте или обновите рецепты для всех готовых блюд:
   - Заполните основные реквизиты (название, категория, время приготовления)
   - Обязательно укажите связь с номенклатурой готового блюда
   - Выберите созданную техкарточку в поле "Технологическая карта"
   - Укажите количество порций в рецепте
   - Система автоматически подтянет данные из техкарточки
   - Воспользуйтесь кнопкой "Пересчитать себестоимость" для обновления расчетов

### Шаг 6: Тестирование
1. Запустите тестовую процедуру: `ТестироватьСистемуРецептов()`
2. Проверьте корректность работы на реальных данных:
   - Создайте тестовую техкарточку
   - Создайте рецепт со ссылкой на техкарточку
   - Оформите продажу через кассу
   - Убедитесь в автоматическом списании ингредиентов по нормам брутто

## Инструкция по использованию

### Для менеджера по техкарточкам:
1. **Создание техкарточки:**
   - Справочники → Технологические карты → Создать
   - Заполнить все обязательные поля на всех страницах
   - Добавить ингредиенты с нормами брутто/нетто и процентами отходов
   - Рассчитать пищевую ценность и себестоимость
   - Записать и закрыть

2. **Редактирование техкарточки:**
   - При изменении ингредиентов обязательно пересчитывать себестоимость и БЖУ
   - Следить за актуальностью цен ингредиентов
   - Контролировать соответствие норм брутто/нетто и процентов отходов

### Для менеджера по рецептам:
1. **Создание рецепта:**
   - Справочники → Кулинарные рецепты → Создать
   - Выбрать техкарточку блюда
   - Заполнить количество порций
   - Система автоматически подтянет данные из техкарточки
   - Записать и закрыть

2. **Редактирование рецепта:**
   - При изменении техкарточки обязательно пересчитывать себестоимость
   - Следить за актуальностью данных техкарточки

### Для кассира:
- Никаких дополнительных действий не требуется
- Списание ингредиентов происходит автоматически при оформлении продажи

### Для аналитика/бухгалтера:
1. **Анализ себестоимости:**
   - Обработки → Анализ себестоимости блюд
   - Выбрать период и склад
   - Получить отчет по использованию ингредиентов

2. **Планирование закупок:**
   - Использовать функцию расчета прогнозных потребностей
   - Анализировать остатки ингредиентов на складах

## Преимущества использования техкарточек

1. **Профессиональный подход:** Техкарточки соответствуют стандартам общественного питания
2. **Детальная информация:** Полная пищевая ценность, нормы брутто/нетто, технология приготовления
3. **Точный учет:** Списание по нормам брутто обеспечивает более точный расчет затрат
4. **Контроль качества:** Требования к сырью и показатели готового блюда
5. **Централизованное управление:** Одна техкарточка может использоваться в нескольких рецептах
6. **Расширяемость:** Легко добавлять новые показатели и характеристики

## Особенности и ограничения

1. **Контроль остатков:**
   - При недостаточном количестве ингредиентов на складе документ продажи не проводится
   - Выводится сообщение с указанием недостающих ингредиентов

2. **Единицы измерения:**
   - Нормы вложения указываются в граммах (брутто/нетто)
   - Цены ингредиентов должны быть в расчете за килограмм
   - Рекомендуется использовать базовые единицы измерения

3. **Актуализация данных:**
   - Стоимость ингредиентов подтягивается из последних поступлений
   - Рекомендуется периодически пересчитывать себестоимость техкарточек
   - При изменении техкарточки необходимо обновить связанные рецепты

4. **Производительность:**
   - При большом количестве техкарточек возможны задержки при проведении документов
   - Рекомендуется оптимизировать запросы для конкретной базы данных

## Возможные доработки

1. **Интеграция с планированием производства**
2. **Автоматический пересчет себестоимости по расписанию**
3. **Контроль сроков годности ингредиентов**
4. **Система уведомлений о критических остатках**
5. **Мобильное приложение для поваров**
6. **Печать технологических карт**
7. **Импорт данных о пищевой ценности из справочников продуктов**
8. **Версионность техкарточек с историей изменений**
9. **Калькулятор масштабирования рецептов**
10. **Интеграция с системами ХАССП**

## Поддержка

При возникновении вопросов или проблем обращайтесь к разработчику системы с указанием:
- Версии конфигурации
- Описания проблемы
- Скриншотов ошибок
- Примера данных, на которых возникла проблема