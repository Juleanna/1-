////////////////////////////////////////////////////////////////////////////////
// МОДУЛЬ МЕНЕДЖЕРА СПРАВОЧНИКА "ЦЕНЫ НА ИНГРЕДИЕНТЫ"
////////////////////////////////////////////////////////////////////////////////

#Область ОбработчикиСобытий

// Обработчик события ПередЗаписью
//
// Параметры:
//  Объект - СправочникОбъект.ЦеныНаИнгредиенты - Записываемый объект
//  Отказ - Булево - Признак отказа от записи
//
Процедура ПередЗаписью(Объект, Отказ) Экспорт

	// При изменении цены запоминаем старое значение для истории
	Если НЕ Объект.ЭтоНовый() И Объект.ЦенаЗаЕдиницу <> Объект.Ссылка.ЦенаЗаЕдиницу Тогда

		// Добавляем запись в историю изменений
		НоваяСтрокаИстории = Объект.ИсторияЦен.Добавить();
		НоваяСтрокаИстории.ДатаИзменения = ТекущаяДата();
		НоваяСтрокаИстории.СтараяЦена = Объект.Ссылка.ЦенаЗаЕдиницу;
		НоваяСтрокаИстории.НоваяЦена = Объект.ЦенаЗаЕдиницу;
		НоваяСтрокаИстории.ПричинаИзменения = "Изменение цены";

	КонецЕсли;

	// Устанавливаем дату установки цены
	Если НЕ ЗначениеЗаполнено(Объект.ДатаУстановкиЦены) Тогда
		Объект.ДатаУстановкиЦены = ТекущаяДата();
	КонецЕсли;

КонецПроцедуры

// Обработчик события ПриЗаписи
//
// Параметры:
//  Объект - СправочникОбъект.ЦеныНаИнгредиенты - Записанный объект
//  Отказ - Булево - Признак отказа от записи
//
Процедура ПриЗаписи(Объект, Отказ) Экспорт

	// После изменения цены обновляем все техкарточки с этим ингредиентом
	Если ЗначениеЗаполнено(Объект.Ингредиент) Тогда
		РасчетСебестоимостиМодуль.ОбновитьЦеныПоИнгредиенту(Объект.Ингредиент);
	КонецЕсли;

КонецПроцедуры

#КонецОбласти