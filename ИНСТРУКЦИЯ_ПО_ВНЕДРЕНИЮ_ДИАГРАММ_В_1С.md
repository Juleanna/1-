# ПОЛНАЯ ИНСТРУКЦИЯ ПО ВНЕДРЕНИЮ ДИАГРАММ В 1C:ПРЕДПРИЯТИЕ 8

## СОДЕРЖАНИЕ
1. [Введение](#введение)
2. [Создание обработки с диаграммами](#создание-обработки-с-диаграммами)
3. [Настройка формы](#настройка-формы)
4. [Добавление элементов управления](#добавление-элементов-управления)
5. [Программирование диаграмм](#программирование-диаграмм)
6. [Типы диаграмм и их применение](#типы-диаграмм-и-их-применение)
7. [Практические примеры](#практические-примеры)
8. [Устранение проблем](#устранение-проблем)

---

## ВВЕДЕНИЕ

Диаграммы в 1C:Предприятие 8 - это мощный инструмент для визуализации данных. Они позволяют:
- Представлять числовые данные в графическом виде
- Анализировать тенденции и сравнивать показатели
- Создавать интерактивные отчеты
- Улучшать восприятие информации пользователями

### Где используются диаграммы:
- **Обработки** - для аналитических отчетов
- **Отчеты** - для визуализации результатов
- **Формы документов** - для показа связанной статистики
- **Табличные документы** - как встроенные элементы

---

## СОЗДАНИЕ ОБРАБОТКИ С ДИАГРАММАМИ

### ШАГ 1: Создание новой обработки

1. **Откройте Конфигуратор**
   - Запустите 1C:Предприятие в режиме Конфигуратора
   - В дереве конфигурации найдите узел "Обработки"

2. **Создайте новую обработку**
   ```
   Правый клик на "Обработки" → "Добавить"
   Имя: АнализСДиаграммами
   Синоним: Анализ с диаграммами
   ```

3. **Настройте свойства обработки**
   ```
   Основные свойства:
   - Имя: АнализСДиаграммами
   - Синоним: Анализ с диаграммами
   - Комментарий: Обработка для создания аналитических диаграмм
   ```

### ШАГ 2: Создание формы обработки

1. **Добавьте форму**
   ```
   Правый клик на обработке → "Добавить" → "Форма"
   Имя формы: Форма
   Назначение: Основная форма
   ```

2. **Настройки формы**
   ```
   Свойства формы:
   - Заголовок: Анализ данных с диаграммами
   - Ширина: 120
   - Высота: 60
   - Изменение размера: Горизонтально и вертикально
   ```

---

## НАСТРОЙКА ФОРМЫ

### ШАГ 3: Добавление реквизитов формы

1. **Откройте редактор формы**
   - Двойной клик на форме в дереве конфигурации

2. **Добавьте реквизиты для параметров отчета**
   ```
   Реквизиты формы:
   
   1. НачалоПериода
      - Тип: Дата
      - Заголовок: Начало периода
      
   2. КонецПериода  
      - Тип: Дата
      - Заголовок: Конец периода
      
   3. Склад
      - Тип: СправочникСсылка.Склады
      - Заголовок: Склад
      
   4. РезультатАнализа
      - Тип: ТаблицаЗначений
      - Заголовок: Результат анализа
   ```

3. **Настройте колонки таблицы результатов**
   ```
   В реквизите РезультатАнализа добавьте колонки:
   
   - Рецепт (СправочникСсылка.КулинарныеРецепты)
   - ГотовоеБлюдо (СправочникСсылка.Номенклатура)  
   - КоличествоПорций (Число)
   - СуммарнаяСебестоимость (Число)
   - СебестоимостьПорции (Число)
   - КоличествоИнгредиентов (Число)
   ```

### ШАГ 4: Размещение элементов на форме

1. **Создайте группы для организации интерфейса**
   ```
   Структура формы:
   
   ├── ГруппаПараметры (Группа, Обычная)
   │   ├── НачалоПериода (Поле ввода)
   │   ├── КонецПериода (Поле ввода)
   │   └── Склад (Поле ввода)
   │
   ├── ГруппаКоманды (Группа, КоманднаяПанель)
   │   ├── Сформировать (Кнопка)
   │   └── ОбновитьДиаграммы (Кнопка)
   │
   ├── ГруппаРезультат (Группа, Страницы)
   │   ├── СтраницаТаблица
   │   │   └── РезультатАнализа (Таблица)
   │   │
   │   ├── СтраницаДиаграммы
   │   │   ├── ДиаграммаСебестоимости (Диаграмма)
   │   │   ├── ДиаграммаКруговая (Диаграмма)  
   │   │   ├── ДиаграммаПорции (Диаграмма)
   │   │   └── ДиаграммаТренд (Диаграмма)
   ```

2. **Настройка элементов диаграмм**
   ```
   Для каждого элемента диаграммы:
   
   Основные свойства:
   - Имя: ДиаграммаСебестоимости (уникальное для каждой)
   - Вид: Диаграмма
   - Источник данных: Не задано (заполняется программно)
   - Ширина: 50
   - Высота: 25
   
   Дополнительные свойства:
   - Заголовок: Анализ себестоимости по блюдам
   - Отображение заголовка: Истина
   - Горизонтальное растягивание: Истина
   - Вертикальное растягивание: Истина
   ```

---

## ДОБАВЛЕНИЕ ЭЛЕМЕНТОВ УПРАВЛЕНИЯ

### ШАГ 5: Создание команд формы

1. **Добавьте команды для работы с диаграммами**
   ```
   Команды формы:
   
   1. Сформировать
      - Заголовок: Сформировать отчет
      - Действие: Сформировать
      - Клавиша: F5
      - Картинка: ОбновитьДанные
   
   2. ОбновитьДиаграммы  
      - Заголовок: Обновить диаграммы
      - Действие: ОбновитьДиаграммы
      - Клавиша: F9
      - Картинка: Диаграмма
      
   3. НастроитьДиаграммы
      - Заголовок: Настроить диаграммы
      - Действие: НастроитьДиаграммы
      - Картинка: Настройка
   ```

2. **Разместите кнопки на форме**
   ```
   В группе ГруппаКоманды добавьте:
   - Кнопка для команды "Сформировать"
   - Кнопка для команды "ОбновитьДиаграммы"  
   - Кнопка для команды "НастроитьДиаграммы"
   ```

### ШАГ 6: Настройка внешнего вида

1. **Настройте оформление групп**
   ```
   ГруппаПараметры:
   - Отображение: Обычная группа
   - Заголовок: Параметры отчета
   - Объединение по горизонтали: Истина
   
   ГруппаРезультат:
   - Отображение: Страницы
   - Расположение заголовков страниц: Сверху
   - Отображение страниц: Закладки
   ```

2. **Настройте таблицу результатов**
   ```
   РезультатАнализа:
   - Режим выбора строк: Строка
   - Использование для выбора: Истина
   - Горизонтальные полосы: Истина
   - Вертикальные линии: Истина
   - Автоматическое изменение ширины: Истина
   ```

---

## ПРОГРАММИРОВАНИЕ ДИАГРАММ

### ШАГ 7: Код модуля формы

1. **Добавьте основной код в модуль формы**

```bsl
#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ПриОткрытии(Отказ)
    
    // Устанавливаем период по умолчанию
    НачалоПериода = НачалоМесяца(ТекущаяДата());
    КонецПериода = КонецДня(ТекущаяДата());
    
    // Очищаем диаграммы
    Очистить();
    
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Сформировать(Команда)
    
    // Проверяем заполнение обязательных параметров
    Если НЕ ЗначениеЗаполнено(НачалоПериода) Тогда
        Сообщить("Укажите начало периода!");
        Возврат;
    КонецЕсли;
    
    Если НЕ ЗначениеЗаполнено(КонецПериода) Тогда
        Сообщить("Укажите конец периода!");
        Возврат;
    КонецЕсли;
    
    // Формируем отчет
    СформироватьОтчетНаСервере();
    
    // Создаем диаграммы
    СоздатьВсеДиаграммы();
    
    // Переключаемся на страницу с диаграммами
    Элементы.ГруппаРезультат.ТекущаяСтраница = Элементы.СтраницаДиаграммы;
    
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьДиаграммы(Команда)
    
    СоздатьВсеДиаграммы();
    
КонецПроцедуры

&НаКлиенте
Процедура НастроитьДиаграммы(Команда)
    
    ОткрытьФорму("Обработка.АнализСДиаграммами.Форма.НастройкиДиаграмм", , ЭтотОбъект);
    
КонецПроцедуры

#КонецОбласти
```

### ШАГ 8: Серверные процедуры получения данных

```bsl
#Область СерверныеПроцедуры

&НаСервере
Процедура СформироватьОтчетНаСервере()
    
    // Параметры для получения данных
    ПараметрыОтчета = Новый Структура;
    ПараметрыОтчета.Вставить("НачалоПериода", НачалоПериода);
    ПараметрыОтчета.Вставить("КонецПериода", КонецПериода);
    ПараметрыОтчета.Вставить("Склад", Склад);
    
    // Получаем данные через обработку анализа
    ОбработкаАнализ = Обработки.АнализСебестоимостиБлюд.Создать();
    ДанныеАнализа = ОбработкаАнализ.ПолучитьДанныеДляАнализа(ПараметрыОтчета);
    
    // Загружаем в табличную часть формы
    РезультатАнализа.Загрузить(ДанныеАнализа);
    
    // Сортируем по убыванию суммарной себестоимости
    РезультатАнализа.Сортировать("СуммарнаяСебестоимость УБЫВ");
    
КонецПроцедуры

&НаСервере
Процедура ОчистительНаСервере()
    
    РезультатАнализа.Очистить();
    
КонецПроцедуры

#КонецОбласти
```

### ШАГ 9: Клиентские процедуры создания диаграмм

```bsl
#Область СозданиеДиаграмм

&НаКлиенте
Процедура СоздатьВсеДиаграммы()
    
    // Проверяем наличие данных
    Если РезультатАнализа.Количество() = 0 Тогда
        ОчиститьВсеДиаграммы();
        Сообщить("Нет данных для построения диаграмм");
        Возврат;
    КонецЕсли;
    
    // Создаем все диаграммы
    СоздатьДиаграммуСебестоимости();
    СоздатьКруговуюДиаграмму();
    СоздатьДиаграммуПорций();
    СоздатьДиаграммуТренда();
    
КонецПроцедуры

&НаКлиенте
Процедура СоздатьДиаграммуСебестоимости()
    
    // Очищаем диаграмму
    ДиаграммаСебестоимости.Очистить();
    
    // Устанавливаем тип
    ДиаграммаСебестоимости.ТипДиаграммы = ТипДиаграммы.Гистограмма;
    ДиаграммаСебестоимости.Заголовок = "Анализ себестоимости по блюдам";
    
    // Настройка осей
    ДиаграммаСебестоимости.ОсьX.Заголовок = "Блюда";
    ДиаграммаСебестоимости.ОсьY.Заголовок = "Себестоимость (руб.)";
    ДиаграммаСебестоимости.ОсьX.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;
    ДиаграммаСебестоимости.ОсьY.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;
    
    // Настройка сетки
    ДиаграммаСебестоимости.ОсьY.Сетка = ОтображениеСеткиДиаграммы.Отображать;
    
    // Создаем серии
    СерияСебестоимостьПорции = ДиаграммаСебестоимости.УстановитьСерию("Себестоимость порции");
    СерияСуммарнаяСебестоимость = ДиаграммаСебестоимости.УстановитьСерию("Общая себестоимость");
    
    // Настройка цветов серий
    СерияСебестоимостьПорции.Цвет = WebЦвета.СинийСтальной;
    СерияСуммарнаяСебестоимость.Цвет = WebЦвета.КрасныйТемный;
    
    // Заполняем данными (берем топ-10 для читаемости)
    Счетчик = 0;
    Для Каждого СтрокаДанных Из РезультатАнализа Цикл
        
        Если Счетчик >= 10 Тогда
            Прервать;
        КонецЕсли;
        
        ИмяТочки = СокрЛП(Строка(СтрокаДанных.ГотовоеБлюдо));
        Если СтрДлина(ИмяТочки) > 15 Тогда
            ИмяТочки = Лев(ИмяТочки, 15) + "...";
        КонецЕсли;
        
        Точка = ДиаграммаСебестоимости.УстановитьТочку(ИмяТочки);
        Точка.УстановитьЗначение(СерияСебестоимостьПорции, СтрокаДанных.СебестоимостьПорции);
        Точка.УстановитьЗначение(СерияСуммарнаяСебестоимость, СтрокаДанных.СуммарнаяСебестоимость);
        
        Счетчик = Счетчик + 1;
        
    КонецЦикла;
    
    // Настройка легенды
    ДиаграммаСебестоимости.ЛегендаИспользование = ИспользованиеЛегендыДиаграммы.Использовать;
    ДиаграммаСебестоимости.ЛегендаРасположение = РасположениеЛегендыДиаграммы.Низ;
    
КонецПроцедуры

&НаКлиенте
Процедура СоздатьКруговуюДиаграмму()
    
    // Очищаем диаграмму
    ДиаграммаКруговая.Очистить();
    
    // Устанавливаем тип
    ДиаграммаКруговая.ТипДиаграммы = ТипДиаграммы.Круговая;
    ДиаграммаКруговая.Заголовок = "Структура затрат по блюдам (топ-6)";
    
    // Создаем серию
    СерияЗатраты = ДиаграммаКруговая.УстановитьСерию("Затраты");
    
    // Массив цветов для секторов
    МассивЦветов = Новый Массив;
    МассивЦветов.Добавить(WebЦвета.Зеленый);
    МассивЦветов.Добавить(WebЦвета.Синий);
    МассивЦветов.Добавить(WebЦвета.Красный);
    МассивЦветов.Добавить(WebЦвета.Оранжевый);
    МассивЦветов.Добавить(WebЦвета.Фиолетовый);
    МассивЦветов.Добавить(WebЦвета.Коричневый);
    
    // Заполняем данными (топ-6)
    Счетчик = 0;
    ИндексЦвета = 0;
    
    Для Каждого СтрокаДанных Из РезультатАнализа Цикл
        
        Если Счетчик >= 6 Тогда
            Прервать;
        КонецЕсли;
        
        ИмяТочки = СокрЛП(Строка(СтрокаДанных.ГотовоеБлюдо));
        Если СтрДлина(ИмяТочки) > 20 Тогда
            ИмяТочки = Лев(ИмяТочки, 20) + "...";
        КонецЕсли;
        
        Точка = ДиаграммаКруговая.УстановитьТочку(ИмяТочки);
        Точка.УстановитьЗначение(СерияЗатраты, СтрокаДанных.СуммарнаяСебестоимость);
        
        // Устанавливаем цвет сектора
        Если ИндексЦвета < МассивЦветов.Количество() Тогда
            Точка.Цвет = МассивЦветов[ИндексЦвета];
            ИндексЦвета = ИндексЦвета + 1;
        КонецЕсли;
        
        Счетчик = Счетчик + 1;
        
    КонецЦикла;
    
    // Настройка отображения
    ДиаграммаКруговая.ЛегендаИспользование = ИспользованиеЛегендыДиаграммы.Использовать;
    ДиаграммаКруговая.ЛегендаРасположение = РасположениеЛегендыДиаграммы.Право;
    ДиаграммаКруговая.ПоказыватьЗначения = Истина;
    
КонецПроцедуры

&НаКлиенте
Процедура СоздатьДиаграммуПорций()
    
    // Очищаем диаграмму
    ДиаграммаПорции.Очистить();
    
    // Устанавливаем тип
    ДиаграммаПорции.ТипДиаграммы = ТипДиаграммы.ГистограммаОбъемная;
    ДиаграммаПорции.Заголовок = "Количество приготовленных порций";
    
    // Настройка осей
    ДиаграммаПорции.ОсьX.Заголовок = "Блюда";
    ДиаграммаПорции.ОсьY.Заголовок = "Количество порций";
    ДиаграммаПорции.ОсьX.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;
    ДиаграммаПорции.ОсьY.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;
    
    // Создаем серию
    СерияПорции = ДиаграммаПорции.УстановитьСерию("Порции");
    СерияПорции.Цвет = WebЦвета.ЗеленыйЛесной;
    
    // Заполняем данными
    Счетчик = 0;
    Для Каждого СтрокаДанных Из РезультатАнализа Цикл
        
        Если Счетчик >= 10 Тогда
            Прервать;
        КонецЕсли;
        
        ИмяТочки = СокрЛП(Строка(СтрокаДанных.ГотовоеБлюдо));
        Если СтрДлина(ИмяТочки) > 15 Тогда
            ИмяТочки = Лев(ИмяТочки, 15) + "...";
        КонецЕсли;
        
        Точка = ДиаграммаПорции.УстановитьТочку(ИмяТочки);
        Точка.УстановитьЗначение(СерияПорции, СтрокаДанных.КоличествоПорций);
        
        Счетчик = Счетчик + 1;
        
    КонецЦикла;
    
КонецПроцедуры

&НаКлиенте
Процедура СоздатьДиаграммуТренда()
    
    // Очищаем диаграмму
    ДиаграммаТренд.Очистить();
    
    // Устанавливаем тип
    ДиаграммаТренд.ТипДиаграммы = ТипДиаграммы.График;
    ДиаграммаТренд.Заголовок = "Зависимость себестоимости от сложности рецепта";
    
    // Настройка осей
    ДиаграммаТренд.ОсьX.Заголовок = "Количество ингредиентов";
    ДиаграммаТренд.ОсьY.Заголовок = "Себестоимость порции (руб.)";
    ДиаграммаТренд.ОсьX.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;
    ДиаграммаТренд.ОсьY.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;
    
    // Создаем серию
    СерияЭффективность = ДиаграммаТренд.УстановитьСерию("Себестоимость/Сложность");
    СерияЭффективность.Цвет = WebЦвета.КрасныйТемный;
    СерияЭффективность.ТипЛинии = ТипЛинииДиаграммы.Сплошная;
    СерияЭффективность.ТипМаркера = ТипМаркераДиаграммы.Круг;
    
    // Сортируем по количеству ингредиентов
    ТаблицаСортированная = РезультатАнализа.Скопировать();
    ТаблицаСортированная.Сортировать("КоличествоИнгредиентов ВОЗР");
    
    // Заполняем данными
    Для Каждого СтрокаДанных Из ТаблицаСортированная Цикл
        
        Точка = ДиаграммаТренд.УстановитьТочку(СтрокаДанных.КоличествоИнгредиентов);
        Точка.УстановитьЗначение(СерияЭффективность, СтрокаДанных.СебестоимостьПорции);
        Точка.Текст = СокрЛП(Строка(СтрокаДанных.ГотовоеБлюдо));
        
    КонецЦикла;
    
    // Настройка сетки
    ДиаграммаТренд.ОсьX.Сетка = ОтображениеСеткиДиаграммы.Отображать;
    ДиаграммаТренд.ОсьY.Сетка = ОтображениеСеткиДиаграммы.Отображать;
    
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьВсеДиаграммы()
    
    ДиаграммаСебестоимости.Очистить();
    ДиаграммаКруговая.Очистить();
    ДиаграммаПорции.Очистить();
    ДиаграммаТренд.Очистить();
    
КонецПроцедуры

&НаКлиенте
Процедура Очистить()
    
    РезультатАнализа.Очистить();
    ОчиститьВсеДиаграммы();
    
КонецПроцедуры

#КонецОбласти
```

---

## ТИПЫ ДИАГРАММ И ИХ ПРИМЕНЕНИЕ

### Основные типы диаграмм

#### 1. Гистограмма (ТипДиаграммы.Гистограмма)
**Применение:** Сравнение значений по категориям
```bsl
Диаграмма.ТипДиаграммы = ТипДиаграммы.Гистограмма;
```
**Подходит для:**
- Сравнение продаж по месяцам
- Анализ себестоимости по товарам
- Сопоставление плановых и фактических значений

#### 2. Круговая диаграмма (ТипДиаграммы.Круговая)
**Применение:** Показ долей от целого
```bsl
Диаграмма.ТипДиаграммы = ТипДиаграммы.Круговая;
```
**Подходит для:**
- Структура затрат
- Доли рынка
- Распределение ресурсов

#### 3. График (ТипДиаграммы.График)
**Применение:** Динамика изменений во времени
```bsl
Диаграмма.ТипДиаграммы = ТипДиаграммы.График;
СерияДанных.ТипЛинии = ТипЛинииДиаграммы.Сплошная;
СерияДанных.ТипМаркера = ТипМаркераДиаграммы.Круг;
```
**Подходит для:**
- Тренды продаж
- Изменение курсов валют
- Динамика показателей

#### 4. Областная диаграмма (ТипДиаграммы.Областная)
**Применение:** Накопительные значения
```bsl
Диаграмма.ТипДиаграммы = ТипДиаграммы.Областная;
```
**Подходит для:**
- Накопительные продажи
- Суммарные объемы производства
- Кумулятивные показатели

#### 5. Лепестковая диаграмма (ТипДиаграммы.Лепестковая)
**Применение:** Многомерный анализ
```bsl
Диаграмма.ТипДиаграммы = ТипДиаграммы.Лепестковая;
```
**Подходит для:**
- Оценка сотрудников по критериям
- Сравнение характеристик товаров
- Анализ KPI

### Настройка внешнего вида

#### Цвета и стили
```bsl
// Установка цвета серии
Серия.Цвет = WebЦвета.Синий;

// Установка цвета точки
Точка.Цвет = WebЦвета.Красный;

// Настройка фона
Диаграмма.ЦветФона = WebЦвета.БелыйДым;
Диаграмма.ФонПрозрачный = Ложь;
```

#### Легенда
```bsl
// Включение легенды
Диаграмма.ЛегендаИспользование = ИспользованиеЛегендыДиаграммы.Использовать;

// Расположение легенды
Диаграмма.ЛегендаРасположение = РасположениеЛегендыДиаграммы.Право; // Низ, Верх, Лево
```

#### Оси и сетка
```bsl
// Заголовки осей
Диаграмма.ОсьX.Заголовок = "Периоды";
Диаграмма.ОсьY.Заголовок = "Значения";
Диаграмма.ОсьX.ОтображениеЗаголовка = ОтображениеЗаголовкаОсиДиаграммы.Отображать;

// Сетка
Диаграмма.ОсьX.Сетка = ОтображениеСеткиДиаграммы.Отображать;
Диаграмма.ОсьY.Сетка = ОтображениеСеткиДиаграммы.Отображать;

// Масштаб
Диаграмма.ОсьY.МинимальноеЗначение = 0;
Диаграмма.ОсьY.МаксимальноеЗначение = 1000;
```

---

## ПРАКТИЧЕСКИЕ ПРИМЕРЫ

### Пример 1: Диаграмма продаж по менеджерам

```bsl
&НаКлиенте
Процедура СоздатьДиаграммуПродажПоМенеджерам()
    
    // Получаем данные
    ДанныеПродаж = ПолучитьДанныеПродажПоМенеджерамНаСервере();
    
    // Очищаем диаграмму
    ДиаграммаПродажи.Очистить();
    
    // Настраиваем диаграмму
    ДиаграммаПродажи.ТипДиаграммы = ТипДиаграммы.Гистограмма;
    ДиаграммаПродажи.Заголовок = "Продажи по менеджерам за " + Формат(НачалоПериода, "ДФ=ММММ yyyy");
    
    // Создаем серии
    СерияФакт = ДиаграммаПродажи.УстановитьСерию("Факт");
    СерияПлан = ДиаграммаПродажи.УстановитьСерию("План");
    
    СерияФакт.Цвет = WebЦвета.Зеленый;
    СерияПлан.Цвет = WebЦвета.СветлоСерый;
    
    // Заполняем данными
    Для Каждого СтрокаДанных Из ДанныеПродаж Цикл
        
        Точка = ДиаграммаПродажи.УстановитьТочку(Строка(СтрокаДанных.Менеджер));
        Точка.УстановитьЗначение(СерияФакт, СтрокаДанных.СуммаФакт);
        Точка.УстановитьЗначение(СерияПлан, СтрокаДанных.СуммаПлан);
        
    КонецЦикла;
    
КонецПроцедуры

&НаСервере
Функция ПолучитьДанныеПродажПоМенеджерамНаСервере()
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    ПродажиОбороты.Менеджер КАК Менеджер,
    |    СУММА(ПродажиОбороты.СуммаОборот) КАК СуммаФакт,
    |    ЕСТЬNULL(ПланыПродаж.СуммаПлан, 0) КАК СуммаПлан
    |ИЗ
    |    РегистрНакопления.Продажи.Обороты(&НачалоПериода, &КонецПериода, , ) КАК ПродажиОбороты
    |        ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПланыПродаж КАК ПланыПродаж
    |        ПО ПродажиОбороты.Менеджер = ПланыПродаж.Менеджер
    |СГРУППИРОВАТЬ ПО
    |    ПродажиОбороты.Менеджер,
    |    ПланыПродаж.СуммаПлан
    |УПОРЯДОЧИТЬ ПО
    |    СуммаФакт УБЫВ";
    
    Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
    Запрос.УстановитьПараметр("КонецПериода", КонецПериода);
    
    Возврат Запрос.Выполнить().Выгрузить();
    
КонецФункции
```

### Пример 2: Динамическая диаграмма с обновлением

```bsl
&НаКлиенте
Процедура ОбновитьДиаграммуПоТаймеру()
    
    // Подключаем таймер для автообновления
    ПодключитьОбработчикОжидания("ОбновлениеДиаграммыПоТаймеру", 30); // каждые 30 секунд
    
КонецПроцедуры

&НаКлиенте
Процедура ОбновлениеДиаграммыПоТаймеру()
    
    // Проверяем, нужно ли обновлять
    Если НЕ АвтообновлениеВключено Тогда
        Возврат;
    КонецЕсли;
    
    // Обновляем данные
    СформироватьОтчетНаСервере();
    СоздатьВсеДиаграммы();
    
КонецПроцедуры
```

### Пример 3: Диаграмма с детализацией

```bsl
&НаКлиенте
Процедура ДиаграммаСебестоимостиВыбор(Элемент, ТочкаДиаграммы, Серия)
    
    // Обработка клика по диаграмме для детализации
    Если ТочкаДиаграммы = Неопределено Тогда
        Возврат;
    КонецЕсли;
    
    // Находим соответствующую строку в таблице
    НайденныеСтроки = РезультатАнализа.НайтиСтроки(
        Новый Структура("ГотовоеБлюдо", ТочкаДиаграммы.Имя));
    
    Если НайденныеСтроки.Количество() > 0 Тогда
        
        // Открываем детализацию
        ПараметрыФормы = Новый Структура;
        ПараметрыФормы.Вставить("Рецепт", НайденныеСтроки[0].Рецепт);
        ПараметрыФормы.Вставить("НачалоПериода", НачалоПериода);
        ПараметрыФормы.Вставить("КонецПериода", КонецПериода);
        
        ОткрытьФорму("Обработка.АнализСебестоимостиБлюд.Форма.ДетализацияПоИнгредиентам", 
                     ПараметрыФормы, ЭтотОбъект);
        
    КонецЕсли;
    
КонецПроцедуры
```

---

## УСТРАНЕНИЕ ПРОБЛЕМ

### Проблема 1: Диаграмма не отображается

**Причины:**
- Нет данных для отображения
- Неправильно настроены серии
- Ошибки в коде заполнения

**Решение:**
```bsl
&НаКлиенте
Процедура ПроверитьДанныеДляДиаграммы()
    
    Если РезультатАнализа.Количество() = 0 Тогда
        Сообщить("Нет данных для построения диаграммы");
        Возврат;
    КонецЕсли;
    
    // Проверяем наличие числовых значений
    ЕстьЧисловыеДанные = Ложь;
    Для Каждого СтрокаДанных Из РезультатАнализа Цикл
        Если СтрокаДанных.СуммарнаяСебестоимость > 0 Тогда
            ЕстьЧисловыеДанные = Истина;
            Прервать;
        КонецЕсли;
    КонецЦикла;
    
    Если НЕ ЕстьЧисловыеДанные Тогда
        Сообщить("Все значения равны нулю");
        Возврат;
    КонецЕсли;
    
КонецПроцедуры
```

### Проблема 2: Медленная работа с большими объемами данных

**Решение:**
```bsl
&НаКлиенте
Процедура ОптимизированноеЗаполнениеДиаграммы()
    
    // Ограничиваем количество точек
    МаксимальноеКоличествоТочек = 20;
    
    // Группируем мелкие значения в "Прочие"
    СуммаПрочих = 0;
    Счетчик = 0;
    
    Для Каждого СтрокаДанных Из РезультатАнализа Цикл
        
        Если Счетчик < МаксимальноеКоличествоТочек Тогда
            
            // Добавляем как отдельную точку
            Точка = Диаграмма.УстановитьТочку(Строка(СтрокаДанных.ГотовоеБлюдо));
            Точка.УстановитьЗначение(Серия, СтрокаДанных.СуммарнаяСебестоимость);
            
        Иначе
            
            // Суммируем в "Прочие"
            СуммаПрочих = СуммаПрочих + СтрокаДанных.СуммарнаяСебестоимость;
            
        КонецЕсли;
        
        Счетчик = Счетчик + 1;
        
    КонецЦикла;
    
    // Добавляем группу "Прочие"
    Если СуммаПрочих > 0 Тогда
        Точка = Диаграмма.УстановитьТочку("Прочие");
        Точка.УстановитьЗначение(Серия, СуммаПрочих);
        Точка.Цвет = WebЦвета.Серый;
    КонецЕсли;
    
КонецПроцедуры
```

### Проблема 3: Нечитаемые подписи на диаграмме

**Решение:**
```bsl
&НаКлиенте
Функция ОбрезатьТекстДляДиаграммы(Текст, МаксимальнаяДлина = 15)
    
    ОбрезанныйТекст = СокрЛП(Текст);
    
    Если СтрДлина(ОбрезанныйТекст) > МаксимальнаяДлина Тогда
        ОбрезанныйТекст = Лев(ОбрезанныйТекст, МаксимальнаяДлина - 3) + "...";
    КонецЕсли;
    
    Возврат ОбрезанныйТекст;
    
КонецФункции
```

---

## ЗАКЛЮЧЕНИЕ

Эта инструкция покрывает все основные аспекты создания диаграмм в 1C:
1. Создание и настройка обработки
2. Программирование различных типов диаграмм
3. Оптимизация производительности
4. Решение типовых проблем

### Рекомендации:
- Всегда проверяйте наличие данных перед построением
- Ограничивайте количество точек для лучшей читаемости
- Используйте подходящие типы диаграмм для конкретных задач
- Настраивайте цвета и стили для улучшения восприятия

### Дальнейшее развитие:
- Добавление интерактивности
- Экспорт диаграмм в файлы
- Создание шаблонов диаграмм
- Интеграция с системой отчетности